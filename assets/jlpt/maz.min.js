var colors={N1:"btn-secondary",N2:"btn-success",N3:"btn-danger",N4:"btn-warning",N5:"btn-info"},data,cookies=[];
function getRuby(a,b,c){$.post("https://labs.goo.ne.jp/api/morph",{app_id:"109cd0ef1cae3c680daeb11bf67f0cbcd5118d58794a4e78218c5488f2f52476",request_id:"huuthanhdtd",sentence:a},function(a){var d="",g=/[\u4e00-\u9faf]/g;$.each(a.word_list,function(a,c){d="";$.each(c,function(a,b){(match=b[0].match(g))&&(d+='<ruby title="'+b[1]+'"><rb>'+b[0]+"</rb><rt>"+wanakana.toHiragana(b[2])+"</rt></ruby>");!match&&(d+='<em title="'+b[1]+'">'+b[0]+"</em>")});$(b[a]).html(d)});cookies[c]=$("div.modal-body").html()},
"json")}
function getKanji(a){$.get("https://mazii.net/api/mazii/"+a+"/10",function(a){$("#results").html("");$.each(a.results,function(a,b){var c="";$.each(b.compDetail,function(a,b){c+=b.w+b.h+", "});var d='<table class="table"><thead><tr><th>#</th><th>H\u00e1n t\u1ef1</th><th>H\u00e1n Vi\u1ec7t</th><th>Ngh\u0129a</th></tr></thead><tbody>';$.each(b.examples,function(a,b){d+="<tr><td>"+(a+1)+"</td><td><ruby><rb>"+b.w+"</rb><rt>"+b.p+"</rt></ruby></td><td><small>"+b.h+"</small></td><td>"+b.m+"</td></tr>"});d+=
"</tbody></table>";null==b.kun&&(b.kun="");null==b.on&&(b.on="");$("#results").append('<div class="col-md-12"><div class="shadow-sm p-3"><div class="row"><div class="col-md-6"><div class="row"><div class="col-md-6 col-sm-6 col-xs-6"><div id="kanjiViewer'+a+'" class="kanjiViewer"></div></div><div class="col-md-6 col-sm-6 col-xs-6"><p><span class="text-muted">B\u1ed9: </span>'+b.kanji+" ("+b.mean+')</p><p><span class="text-muted">Kun: </span>'+b.kun+'</p><p><span class="text-muted">On: </span>'+b.on+
'</p><p><span class="text-muted">S\u1ed1 n\u00e9t: </span>'+b.stroke_count+'</p><p><span class="text-muted">JLPT: </span>N'+b.level+'</p><p><span class="text-muted">G\u1ed3m: </span>'+c+"</p></div></div><h4>Ngh\u0129a: </h4><ul><li>"+b.detail.replace(/##/g,"</li><li>")+'</li></ul></div><div class="col-md-6"><h4>V\u00ed d\u1ee5:</h4><div>'+d+"</div></div></div></div></div>");$.extend({},KanjiViewer).initialize("kanjiViewer"+a,3,4,100,!0,!1,b.kanji)})})}
function convertJptoHex(a){if(null==a||""==a)return"";-1!=a.indexOf("\u300c")&&(a=(a=a.replace(RegExp("\u300c","g"),"")).replace(RegExp("\u300d","g"),""));a=a.trim();for(var b="",c=0;c<a.length;c++)b+=("0000"+a.charCodeAt(c).toString(16)).substr(-4),c!=a.length-1&&(b+="_");return b}
function getWord(a){$.get("https://mazii.net/api/search/"+a+"/20/1",function(b){$("#results").html("");$.each(b.data,function(b,a){var c="<ul>";$.each(a.means,function(a,b){c+=null==b.kind?"<li>"+b.mean+"</li>":"<li>("+b.kind+") "+b.mean+"</li>"});c+="</ul>";var d=convertJptoHex(a.word).toUpperCase();$("#results").append('<div class="col-md-12"><div class="shadow-sm p-3 md5"><h3 class="text-success">'+a.word+'&nbsp;&nbsp;<small class="text-muted">'+a.phonetic+'</small> <span class="volume" data-id="'+
d+'">&nbsp;</span></h3><p>'+c+"</p></div></div>")})})}
function getSentence(a){$.get("https://mazii.net/api/smile/"+a,function(b){$("#results").html("");var a;$.each(b.results,function(b,c){c.content.match(/[\u3040-\u309f]|[\u4e00-\u9faf]/gi)||(a=c.mean,c.mean=c.content,c.content=a);$("#results").append('<div class="col-md-12"><div class="shadow-sm p-3 md5"><h3 class="text-info sentence" id="h3'+b+'">'+c.content+'</h3><p class="meaning">'+c.mean+"</p></div></div>")});var d=[],e=[];$("h3.sentence").each(function(a){d.push($(this).text());e.push("#"+$(this).attr("id"))});
getRuby(d.join("\r\n"),e,"getSentence")})}
function getGrammar(){$.ajax({type:"POST",url:"https://mazii.net/api/search",crossDomain:!0,dataType:"json",data:data,success:function(a){cookies=[];$("#results").html("");if(302==a.status)$("#results").html('<div class="col-md-12">Kh\u00f4ng c\u00f3 k\u1ebft qu\u1ea3</div>');else{var b;$.each(a.results,function(a,c){b=void 0==c.category?"":c.category;$("#results").append('<div class="col-md-3 col-sm-6"><div class="card mb-3 sm-6 shadow-sm"><div class="card-body"><h5 class="card-title">'+c.title.replace("=>",
'</h5><p class="card-text">')+'</p><div class="d-flex justify-content-between align-items-center"><button type="button" class="btn btn-sm grammar '+colors[c.level]+'" data-toggle="modal" data-id="'+c._id+'" data-target="#exampleModal" data-grammar="'+c.title+'">'+c.level+'</button>&nbsp;<small class="text-muted">'+b+"</small></div></div></div></div>")});$(".pagination").html("");if(12<a.total){a=Math.ceil(a.total/12);var c=data.page,d=Math.max(1,c-2),e=Math.min(a,c+2);3<c&&($(".pagination").append('<li class="page-item"><a class="page-link" data-page="1">&laquo;</a></li>'),
$(".pagination").append('<li class="page-item disabled"><a class="page-link" data-page="0">...</a></li>'));for(i=d;i<=e;i++)d=i==c?" disabled":"",$(".pagination").append('<li class="page-item'+d+'"><a class="page-link" href="#" data-page="'+i+'">'+i+"</a></li>");a>c+2&&($(".pagination").append('<li class="page-item disabled"><a class="page-link" data-page="0">...</a></li>'),$(".pagination").append('<li class="page-item"><a class="page-link" data-page="'+a+'">&raquo;</a></li>'))}}},error:function(a){}})}
$("#mazii").submit(function(a){a.preventDefault();$(".pagination").html("");data={dict:"javi",type:"grammar",level:"",category:"",query:"",page:1,limit:12};a=$("#query").val();var b=a.match(/N[1-5]:|N:|K:|S:|W:/gi);if(b)switch(b[0].toLowerCase()){case "k:":b=a.match(/(K:)|[\u4e00-\u9faf]{1,16}/gi);1<b.length&&getKanji(a.replace(/K:/gi,""));break;case "s:":getSentence(a.replace(/S:/gi,""));break;case "w:":getWord(a.replace(/W:/gi,""));break;default:data.query=a,b=/(N+[1-5])*:|(N:)/gi,(b=b.exec(a))&&
(data.level=b[1],data.query=a.replace(b[0],"").trim()),getGrammar()}else data.query=a,b=/(N+[1-5])*:|(N:)/gi,(b=b.exec(a))&&(data.level=b[1],data.query=a.replace(b[0],"").trim()),getGrammar()});$("ul.pagination").on("click","a",function(a){a.preventDefault();data.page=$(this).data("page");getGrammar()});
$("#results").on("click","button.grammar",function(a){var b="<p>",c="",d=$(this).data("id");cookies.hasOwnProperty(d)?($("#exampleModalLabel").html('<button class="btn btn-sm '+colors[$(this).text()]+'">'+$(this).text()+"</button>&nbsp;&nbsp;"+$(this).data("grammar")),$("div.modal-body").html(cookies[d])):$.getJSON("https://mazii.net/api/grammar/"+d,function(a){$("#exampleModalLabel").html('<button class="btn btn-sm '+colors[a.grammar.level]+'">'+a.grammar.level+"</button>&nbsp;&nbsp;"+a.grammar.title);
$.each(a.grammar.usages,function(a,d){b="";$.each(d.examples,function(c,d){b+='<p class="example"><span class="text-primary" id="ex'+a+c+'">'+d.content.trim().replace(/(&lt;([^&gt;]+)&gt;)/ig,"")+"</span><br>"+d.mean.trim()+"</p>"});c+='<div class="alert alert-dark" role="alert">'+d.synopsis+"<br>"+d.explain+"</div>"+b});$("div.modal-body").html(c);var e=[],f=[];$("p.example span").each(function(a){e.push($(this).text());f.push("#"+$(this).attr("id"))});getRuby(e.join(""),f,d);a={};a[d]=$("div.modal-body").html();
cookies.push(a)})});$("div.input-group-prepend button").click(function(a){a=$(this).data("key");var b=$("#query").val(),c=b.match(/N[1-5]:|N:|K:|S:|W:/gi);c?$("#query").val(b.replace(c[0],a)):$("#query").val(a+b);$("#query").focus()});var audio=new Audio;$("#results").on("click","span.volume",function(a){audio.src="https://data.mazii.net/audios/"+$(this).data("id")+".mp3";audio.autoplay=!0});