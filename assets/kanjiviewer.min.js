KanjiViewer={initialize:function(a,c,b,g,d,e,f){this.paper=new Raphael(a,"100%","100%");this.strokeWidth=c;this.fontSize=b;this.displayOrders=d;this.colorGroups=e;this.kanji=f;this.fetchNeeded=!0;this.setZoom(g);this.refreshKanji()},setZoom:function(a){this.paper.setViewBox(0,0,109,109)},setStrokeWidth:function(a){this.strokeWidth=a},setFontSize:function(a){this.fontSize=a},setStrokeOrdersVisible:function(a){this.displayOrders=a},setColorGroups:function(a){this.colorGroups=a},setKanji:function(a){a!=
this.kanji&&""!=a&&void 0!=a&&(this.kanji=a,this.fetchNeeded=!0)},refreshKanji:function(){if(this.fetchNeeded&&""!=this.kanji){var a=this;this.paper.clear();this.paper.text(0,0,this.kanji).attr({x:50,y:50,fill:"black","font-size":18,"text-anchor":"start"});var c=this.kanji.charCodeAt(0).toString(16);jQuery.ajax({url:"/action/ajax?do=daily&q="+c+"&k="+this.kanji,dataType:"json",success:function(b){!1!==b.svg?(a.fetchNeeded=!1,a.xml=b.svg,a.drawKanji()):(a.paper.clear(),a.paper.text(0,0,a.kanji).attr({x:10,
y:50,fill:"black","font-size":80,"stroke-width":2,stroke:"#FFFFFF","text-anchor":"start"}))},statusCode:{404:function(){a.paper.clear();a.paper.text(0,0,a.kanji+" not found").attr({x:50,y:50,fill:"black","font-size":18,"text-anchor":"start"})}}})}else this.drawKanji()},createStroke:function(a,c){var b=this.paper.path(jQuery(a).attr("d"));b.initialColor=c;b.attr({stroke:c,"stroke-width":this.strokeWidth,"stroke-linecap":"round","stroke-linejoin":"round"});return b},createHover:function(a){var c=Raphael.animation({stroke:"black"},
300),b=Raphael.animation({stroke:a.initialColor},300);a.hover(function(){this.animate(c)},function(){this.animate(b)})},createHovers:function(a){for(var c=this,b=Raphael.animation({stroke:"black"},300),g=Raphael.animation({stroke:a[0].initialColor},300),d=0;d<a.length;d++){var e=a[d];e.hover(function(){for(var d=0;d<a.length;d++)e=a[d],e.attr({cursor:"pointer"}),e.animate(b)},function(){for(var b=0;b<a.length;b++)e=a[b],e.animate(g)});e.click(function(){c.setKanji(a.element);c.refreshKanji()})}},
drawKanji:function(){var a=this;this.paper.clear();Raphael.getColor.reset();var c=jQuery(this.xml).find("svg > g > g > g");this.colorGroups&&0!=c.length?c.each(function(){var b=Raphael.getColor();a.paper.setStart();jQuery(this).find("path").each(function(){a.createStroke(this,b)});var c=a.paper.setFinish(),d=jQuery(this).attr("kvg:element");if(void 0==d)for(var e=jQuery(this).find("g"),f=0;f<e.length;f++){if(d=jQuery(e[f]).attr("kvg:element"),void 0!==d){c.element=d;break}}else c.element=d;a.createHovers(c)}):
jQuery(this.xml).find("path").each(function(){var b=Raphael.getColor();b=a.createStroke(this,b);a.createHover(b)});jQuery(this.xml).find("text").each(function(){var b=Raphael.color("#808080"),c=jQuery(this).text(),d=jQuery(this).attr("transform"),e=d.split(" ")[4];d=d.split(" ")[5].replace(")","");c=a.paper.text(e,d,c);c.attr({fill:b,"font-size":a.fontSize});a.displayOrders||c.hide()})}};